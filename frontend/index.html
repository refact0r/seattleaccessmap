<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>seattleAccessMap</title>
		<link
			rel="stylesheet"
			href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
		/>
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400&display=swap"
		/>
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
		<link rel="stylesheet" href="style.css" />
		<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
	</head>

	<body>
		<!-- ── Top Navigation ── -->
		<nav class="top-nav">
			<div class="brand">
				<img
					src="logo.svg"
					alt="seattleAccessMap logo"
					class="brand-logo"
				/>
				<span class="brand-text">seattleAccessMap</span>
			</div>
			<div class="nav-tabs">
				<button class="nav-tab active" data-view="about">About</button>
				<button class="nav-tab" data-view="explore">Explore</button>
				<button class="nav-tab" data-view="route">Route</button>
				<button class="nav-tab" data-view="analytics">Insights</button>
			</div>
		</nav>

		<!-- ── Main Content ── -->
		<div class="content">
			<!-- ── Left Panel ── -->
			<div class="left-panel">
				<!-- ═══ ABOUT VIEW ═══ -->
				<div class="view-content active" id="view-about">
					<div class="about-content">
						<div class="about-section">
							<h2>seattleAccessMap</h2>
							<p>
								Seattle's sidewalks are not equally accessible.
								People with mobility challenges face obstacles
								that most pedestrians never notice, like missing
								curb ramps, broken surfaces, and blocked paths.
								The Access to Everyday Life track's dataset from
								Project Sidewalk contains ~80,000 crowdsourced
								observations of sidewalk conditions in Seattle.
								Using this data, we built a system that (1)
								reveals where the problems are, (2) routes users
								around them, and (3) informs the city which
								sidewalks to prioritize fixing first.
							</p>
						</div>

						<div class="about-section">
							<h3>Dataset & Cleaning</h3>
							<p>
								The Project Sidewalk dataset contains 6 label
								types. Each record also has coordinates,
								neighborhood, severity (1-5), and a temporary
								flag. From 81,973 raw records, we kept
								<strong>79,722</strong>
								after dropping rows with missing severity
								ratings.
							</p>
						</div>

						<div class="about-section">
							<h3>Adjusted Severity Metric</h3>
							<p>
								Raw severity (1-5) doesn't account for the
								differences in the label types. A lack of a
								sidewalk is more impactful than a damaged curb
								ramp, even if both are rated severity 3. In
								fact, after investigating Project Sidewalk's
								labelling methodology (by labelling a couple of
								sidewalks ourselves!), we found that a severity
								1 CurbRamp indicates the existence of a passable
								curb ramp (which is a good thing). We defined a
								normalized 0-10 scale with rescaling ranges
								based on real-world impact:
							</p>
							<table class="about-table">
								<thead>
									<tr>
										<th>Label</th>
										<th>Range</th>
										<th>Rationale</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>NoSidewalk</td>
										<td>5 - 10</td>
										<td>
											Always significant; no sidewalk at
											any severity is impactful
										</td>
									</tr>
									<tr>
										<td>NoCurbRamp</td>
										<td>3 - 8</td>
										<td>
											Missing ramp is always a real
											barrier
										</td>
									</tr>
									<tr>
										<td>Obstacle</td>
										<td>2 - 7</td>
										<td>
											Obstruction; maps directly to impact
										</td>
									</tr>
									<tr>
										<td>SurfaceProblem</td>
										<td>1 - 6</td>
										<td>
											Damaged surface; impactful but less
											severe
										</td>
									</tr>
									<tr>
										<td>CurbRamp</td>
										<td>0 - 5</td>
										<td>
											Positive feature; ramp exists but
											may be degraded
										</td>
									</tr>
									<tr>
										<td>Other</td>
										<td>1 - 4</td>
										<td>Miscellaneous; low weight</td>
									</tr>
								</tbody>
							</table>
							<button class="about-cta" data-goto="analytics">
								View analytics &rarr;
							</button>
						</div>

						<div class="about-section">
							<h3>Map Visualization</h3>
							<p>
								We plotted every barrier observation directly on
								the map and color-coded each point by adjusted
								severity. We also added a heatmap layer to
								reveal areas with the highest overall
								concentration of issues.
							</p>
							<button
								class="about-cta"
								data-goto="explore"
								data-explore="barriers"
							>
								Explore the map &rarr;
							</button>
						</div>

						<div class="about-section">
							<h3>Hotspot Clustering</h3>
							<p>
								We use <strong>HDBSCAN</strong>, an unsupervised
								ML clustering method, to identify barrier
								hotspots. This is useful for people wishing to
								avoid such areas, or for city planners looking
								to identify areas to prioritize. We identified
								<strong>641</strong>
								clusters.
							</p>
							<p>
								We chose HDBSCAN because unlike k-means, it does
								not force every point into a group and it does
								not require a preset cluster count, which is
								helpful when hotspot density varies by
								neighborhood. We use the haversine distance
								metric to cluster based on accurate geographic
								distance.
							</p>
							<button
								class="about-cta"
								data-goto="explore"
								data-explore="clusters"
							>
								Explore clusters on the map &rarr;
							</button>
						</div>

						<div class="about-section">
							<h3>Fix Priorities</h3>
							<p>
								Hotspots show where barriers concentrate, but we
								decided to take it one step further by
								identifying exactly which barriers produce the
								most day-to-day impact. We rank individual
								barriers by combining adjusted severity with how
								central their street segment is in the
								pedestrian network.
							</p>
							<p class="about-formula">
								impact = adjusted_severity &times; log(1 +
								edge_usage)
							</p>
							<p>
								We estimate <em>edge_usage</em> by sampling
								~1,000 random shortest routes and counting how
								often each street segment appears. This
								highlights barriers on important roads and
								connectors. The log keeps usage from
								overpowering severity, so a small issue on a
								busy street still ranks below a severe
								obstruction in a moderately used area.
							</p>
							<p>
								The map highlights the <strong>top 200</strong>
								barriers by impact. Ties are broken by higher
								adjusted severity, then by edge usage, ensuring
								that consistently disruptive barriers surface
								first.
							</p>
							<button
								class="about-cta"
								data-goto="explore"
								data-explore="priorities"
							>
								Explore fix priorities on the map &rarr;
							</button>
						</div>

						<div class="about-section">
							<h3>Accessibility-Aware Routing</h3>
							<p>
								We built a route planner on the real Seattle
								pedestrian network (via OpenStreetMap/OSMnx).
								Each barrier is snapped to its nearest network
								edge, and the edge's accessibility cost is the
								sum of adjusted severities on that edge.
							</p>
							<p>
								The routing algorithm is modified Dijkstra's: it
								expands outward from the start node, always
								picking the next unvisited node with the lowest
								cumulative cost so far, and relaxes edges to
								update the cheapest known path to each neighbor.
								Edge cost is a weighted combination of distance
								and barrier severity:
							</p>
							<p class="about-formula">
								edge cost = distance + barrier_severity &times;
								cost<sup>1.5</sup>
							</p>
							<p>
								The <strong>1.5 exponent</strong> produces a
								smooth gradient of route alternatives across the
								tolerance slider. At one end, the route takes
								significant detours to avoid as many barriers as
								possible. At the other, it's the pure shortest
								path.
							</p>
							<button class="about-cta" data-goto="route">
								Try the router &rarr;
							</button>
						</div>

						<div class="about-section">
							<h3>Key Findings</h3>
							<ul class="about-list">
								<li>
									Barriers are not uniformly distributed, some
									neighborhoods are worse than others
								</li>
								<li>
									Neighborhoods with the highest barrier count
									and highest average severity are often
									different
								</li>
								<li>
									Accessible routes typically add 10-30%
									distance to avoid the worst barriers - a
									meaningful but manageable tradeoff
								</li>
								<li>
									Fix prioritization shows that a small number
									of high-traffic barriers create
									disproportionate impact
								</li>
							</ul>
						</div>

						<div class="about-section">
							<h3>Limitations & Potential Expansions</h3>
							<ul class="about-list">
								<li>
									Coverage is uneven, so a low barrier count
									may mean good sidewalks or poor survey
									coverage
								</li>
								<li>
									Our rescaled severity metric is a best
									effort guess and might not reflect real
									world experiences
								</li>
								<li>
									Temporary barriers change and repairs happen
								</li>
								<li>
									Barrier snapping to the nearest edge is
									approximate in dense areas
								</li>
								<li>
									Potential expansions: elevation/slope data,
									transit connections, and demographic/equity
									analysis
								</li>
							</ul>
						</div>
					</div>
				</div>

				<!-- ═══ EXPLORE VIEW ═══ -->
				<div class="view-content" id="view-explore">
					<div class="panel-section">
						<h3>Overview</h3>
						<div class="stats-row">
							<div class="stat-box">
								<div class="value" id="stat-total">--</div>
								<div class="label">Barriers</div>
							</div>
							<div class="stat-box">
								<div class="value" id="stat-visible">--</div>
								<div class="label">Visible</div>
							</div>
							<div class="stat-box">
								<div class="value" id="stat-avg-sev">--</div>
								<div class="label">Avg Severity</div>
							</div>
						</div>
					</div>

					<div class="panel-section">
						<h3>Filter</h3>

						<div class="filter-group">
							<label>Types</label>
							<div class="checkbox-grid">
								<label class="checkbox-item">
									<input
										type="checkbox"
										data-type="CurbRamp"
										checked
									/>
									Curb Ramp
								</label>
								<label class="checkbox-item">
									<input
										type="checkbox"
										data-type="NoCurbRamp"
										checked
									/>
									No Curb Ramp
								</label>
								<label class="checkbox-item">
									<input
										type="checkbox"
										data-type="NoSidewalk"
										checked
									/>
									No Sidewalk
								</label>
								<label class="checkbox-item">
									<input
										type="checkbox"
										data-type="Obstacle"
										checked
									/>
									Obstacle
								</label>
								<label class="checkbox-item">
									<input
										type="checkbox"
										data-type="SurfaceProblem"
										checked
									/>
									Surface Problem
								</label>
								<label class="checkbox-item">
									<input
										type="checkbox"
										data-type="Other"
										checked
									/>
									Other
								</label>
							</div>
						</div>

						<div class="filter-group">
							<label>Severity Range</label>
							<div class="severity-range">
								<span id="sev-min-val">0</span>
								<input
									type="range"
									id="sev-min"
									min="0"
									max="10"
									value="0"
									step="0.5"
								/>
								<input
									type="range"
									id="sev-max"
									min="0"
									max="10"
									value="10"
									step="0.5"
								/>
								<span id="sev-max-val">10</span>
							</div>
						</div>

						<div class="filter-group">
							<div class="toggle-row">
								<label class="toggle-label"
									>Hide Temporary</label
								>
								<input type="checkbox" id="hide-temp" />
							</div>
						</div>
					</div>

					<div class="panel-section">
						<h3>Fix Priorities</h3>
						<div id="priorities-list" class="priorities-list"></div>
					</div>
				</div>

				<!-- ═══ ROUTE VIEW ═══ -->
				<div class="view-content" id="view-route">
					<div class="panel-section">
						<h3>Set Points</h3>
						<div class="click-mode-buttons">
							<button
								id="set-origin-btn"
								class="click-mode-btn origin"
							>
								Set Origin
							</button>
							<button
								id="set-destination-btn"
								class="click-mode-btn destination"
							>
								Set Destination
							</button>
						</div>
						<div class="input-group">
							<label>Origin</label>
							<div class="input-row">
								<input
									type="number"
									id="start-lat"
									placeholder="Lat"
									step="0.0001"
									value="47.6551"
								/>
								<input
									type="number"
									id="start-lng"
									placeholder="Lng"
									step="0.0001"
									value="-122.3046"
								/>
							</div>
						</div>
						<div class="input-group">
							<label>Destination</label>
							<div class="input-row">
								<input
									type="number"
									id="end-lat"
									placeholder="Lat"
									step="0.0001"
									value="47.6305"
								/>
								<input
									type="number"
									id="end-lng"
									placeholder="Lng"
									step="0.0001"
									value="-122.3566"
								/>
							</div>
						</div>
						<div class="examples">
							<p><strong>Examples:</strong></p>
							<p>
								<a onclick="setExample1()">UW → Queen Anne</a>
							</p>
							<p>
								<a onclick="setExample2()">UW → Capitol Hill</a>
							</p>
						</div>
					</div>

					<div class="panel-section">
						<h3>Accessibility Tolerance</h3>
						<div class="slider-group">
							<div class="slider-container">
								<input
									type="range"
									id="tolerance-slider"
									class="slider"
									min="0"
									max="100"
									value="50"
									step="1"
								/>
							</div>
							<div class="slider-labels">
								<span>Max accessibility</span>
								<span>Standard</span>
								<span>Fastest route</span>
							</div>
						</div>
						<button id="calculate-btn" class="btn-primary">
							Calculate Route
						</button>
						<div id="status-message"></div>
					</div>

					<div id="route-results" class="panel-section is-hidden">
						<h3>Route Comparison</h3>
						<div id="route-content"></div>
					</div>
				</div>

				<!-- ═══ ANALYTICS VIEW ═══ -->
				<div class="view-content" id="view-analytics">
					<div class="analytics-content">
						<h2>Data Insights</h2>
						<p class="analytics-intro">
							Summary statistics from 79,722 crowdsourced sidewalk
							accessibility observations across Seattle.
						</p>
						<div id="analytics-container">
							<div class="analytics-loading">
								<div class="spinner"></div>
								<p>Loading analytics...</p>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- ── Map ── -->
			<div class="map-container">
				<div id="map"></div>

				<!-- Legend Overlay -->
				<div class="legend-stack" id="legend-stack">
					<div
						class="map-overlay legend legend-base"
						id="legend-severity"
					>
						<div class="legend-title">Adjusted Severity</div>
						<div class="legend-row">
							<span class="legend-min">0</span>
							<div class="legend-bar"></div>
							<span class="legend-max">10</span>
						</div>
					</div>
					<div
						class="map-overlay legend legend-priorities is-hidden"
						id="legend-priorities"
					>
						<div class="legend-title">Fix Priority Impact</div>
						<div class="legend-row">
							<span class="legend-min">Low</span>
							<div class="legend-bar legend-bar-priority"></div>
							<span class="legend-max">High</span>
						</div>
					</div>
				</div>

				<!-- Layer Toggles Overlay -->
				<div class="map-overlay layer-toggles">
					<div class="layer-toggle">
						<input type="checkbox" id="toggle-barriers" checked />
						<label for="toggle-barriers">Barrier Points</label>
					</div>
					<div class="layer-toggle">
						<input type="checkbox" id="toggle-heatmap" />
						<label for="toggle-heatmap">Severity Heatmap</label>
					</div>
					<div class="layer-toggle">
						<input type="checkbox" id="toggle-clusters" />
						<label for="toggle-clusters">Hotspot Clusters</label>
					</div>
					<div class="layer-toggle">
						<input type="checkbox" id="toggle-priorities" />
						<label for="toggle-priorities">Fix Priorities</label>
					</div>
				</div>
			</div>
		</div>

		<script type="module" src="app.js"></script>
	</body>
</html>
